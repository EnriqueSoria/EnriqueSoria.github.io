<!doctype html><html lang=en-us>
<head>
<title>Create mantainable env.sample using django-environ // Enrique Soria</title>
<link rel="shortcut icon" href=/favicon.ico>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.91.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Enrique Soria">
<meta name=description content>
<link rel=stylesheet href=https://enriquesoria.github.io/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Create mantainable env.sample using django-environ">
<meta name=twitter:description content="Create mantainable env.sample using django-environ Put every env var with its configuration when instantiating Env object from environ import Env env = Env( VARIABLE_WITH_DEFAULT_VALUE=(str, &#34;default value&#34;), VARIABLE_WITHOUT_DEFAULT_VALUE=str, ) value = env(&#34;VARIABLE_WITH_DEFAULT_VALUE&#34;) value = env(&#34;VARIABLE_WITHOUT_DEFAULT_VALUE&#34;) Use this script that uses the Env instance to generate an env.sample from pathlib import Path import click import sys from environ import Env def get_env_config() -> Env: # Add env_location to python path so it can find it.">
<meta property="og:title" content="Create mantainable env.sample using django-environ">
<meta property="og:description" content="Create mantainable env.sample using django-environ Put every env var with its configuration when instantiating Env object from environ import Env env = Env( VARIABLE_WITH_DEFAULT_VALUE=(str, &#34;default value&#34;), VARIABLE_WITHOUT_DEFAULT_VALUE=str, ) value = env(&#34;VARIABLE_WITH_DEFAULT_VALUE&#34;) value = env(&#34;VARIABLE_WITHOUT_DEFAULT_VALUE&#34;) Use this script that uses the Env instance to generate an env.sample from pathlib import Path import click import sys from environ import Env def get_env_config() -> Env: # Add env_location to python path so it can find it.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://enriquesoria.github.io/mantainable-env-sample/"><meta property="article:section" content>
<meta property="article:published_time" content="2022-09-20T08:00:00+02:00">
<meta property="article:modified_time" content="2022-09-20T08:00:00+02:00">
</head>
<body>
<header class=app-header>
<a href=https://enriquesoria.github.io><img class=app-header-avatar src="https://avatars.githubusercontent.com/u/7394684?v=4" alt="Enrique Soria"></a>
<span class=app-header-title>Enrique Soria</span>
<nav class=app-header-menu>
<a class=app-header-menu-item href=/tags/>Tags</a>
</nav>
<p>Software developer</p>
<div class=app-header-social>
<a href=https://github.com/EnriqueSoria target=_blank rel="noreferrer noopener me"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>My Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
<a href=https://twitter.com/esoria_dev/ target=_blank rel="noreferrer noopener me"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Create mantainable env.sample using django-environ</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Sep 20, 2022
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
2 min read
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://enriquesoria.github.io/tags/django/>django</a>
<a class=tag href=https://enriquesoria.github.io/tags/env/>env</a>
</div>
</div>
</header>
<div class=post-content>
<h1 id=create-mantainable-envsample-using-django-environhttpsgithubcomjoke2kdjango-environ>Create mantainable env.sample using <a href=https://github.com/joke2k/django-environ>django-environ</a></h1>
<h2 id=put-every-env-var-with-its-configuration-when-instantiating-env-object>Put every env var with its configuration when instantiating <code>Env</code> object</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> environ <span style=color:#f92672>import</span> Env

env <span style=color:#f92672>=</span> Env(
    VARIABLE_WITH_DEFAULT_VALUE<span style=color:#f92672>=</span>(str, <span style=color:#e6db74>&#34;default value&#34;</span>),
    VARIABLE_WITHOUT_DEFAULT_VALUE<span style=color:#f92672>=</span>str,
)

value <span style=color:#f92672>=</span> env(<span style=color:#e6db74>&#34;VARIABLE_WITH_DEFAULT_VALUE&#34;</span>)
value <span style=color:#f92672>=</span> env(<span style=color:#e6db74>&#34;VARIABLE_WITHOUT_DEFAULT_VALUE&#34;</span>)
</code></pre></div><h2 id=use-this-script-that-uses-the-env-instance-to-generate-an-envsample>Use this script that uses the <code>Env</code> instance to generate an <code>env.sample</code></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path

<span style=color:#f92672>import</span> click
<span style=color:#f92672>import</span> sys
<span style=color:#f92672>from</span> environ <span style=color:#f92672>import</span> Env


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_env_config</span>() <span style=color:#f92672>-&gt;</span> Env:
    <span style=color:#75715e># Add env_location to python path so it can find it.  </span>
    env_location <span style=color:#f92672>=</span> Path(<span style=color:#e6db74>&#34;app/your_app/&#34;</span>)  
    sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>append(str(env_location<span style=color:#f92672>.</span>absolute()))
    
    <span style=color:#75715e># Import env instance</span>
    <span style=color:#f92672>from</span> your_app <span style=color:#f92672>import</span> settings
    <span style=color:#66d9ef>return</span> settings<span style=color:#f92672>.</span>env


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_env_sample_text</span>(env: Env, write_defaults: bool <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>) <span style=color:#f92672>-&gt;</span> str:
    text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
    <span style=color:#66d9ef>for</span> env_name, env_config <span style=color:#f92672>in</span> env<span style=color:#f92672>.</span>scheme<span style=color:#f92672>.</span>items():
        has_default: bool <span style=color:#f92672>=</span> isinstance(env_config, tuple) <span style=color:#f92672>and</span> len(env_config) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>

        <span style=color:#66d9ef>if</span> has_default:
            <span style=color:#66d9ef>if</span> write_defaults:
                cast, default_value <span style=color:#f92672>=</span> env_config
                text <span style=color:#f92672>+=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>env_name<span style=color:#e6db74>}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>{</span>default_value<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
        <span style=color:#66d9ef>else</span>:
            text <span style=color:#f92672>+=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>env_name<span style=color:#e6db74>}</span><span style=color:#e6db74>=</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>

    <span style=color:#66d9ef>return</span> text


<span style=color:#a6e22e>@click</span><span style=color:#f92672>.</span>command()
<span style=color:#a6e22e>@click</span><span style=color:#f92672>.</span>option(
    <span style=color:#e6db74>&#34;--file&#34;</span>,
    <span style=color:#e6db74>&#34;-f&#34;</span>,
    default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./env.sample&#34;</span>,
    help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Path of the sample env file&#34;</span>,
    show_default<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
)
<span style=color:#a6e22e>@click</span><span style=color:#f92672>.</span>option(
    <span style=color:#e6db74>&#34;--defaults&#34;</span>,
    <span style=color:#e6db74>&#34;-d&#34;</span>,
    is_flag<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
    default<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
    help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Write default values to sample env file&#34;</span>,
    show_default<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
)
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_env_sample</span>(<span style=color:#f92672>*</span>, file: str, defaults: bool):
    env <span style=color:#f92672>=</span> get_env_config()

    <span style=color:#75715e># Write env sample</span>
    text <span style=color:#f92672>=</span> get_env_sample_text(env, write_defaults<span style=color:#f92672>=</span>defaults)
    <span style=color:#66d9ef>with</span> open(file, <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
        f<span style=color:#f92672>.</span>write(text)


<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    generate_env_sample()

</code></pre></div><h2 id=add-it-to-your-pre-commit-so-it-never-gets-outdated>Add it to your pre-commit so it never gets outdated</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>repos</span>:
- <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>local</span>
  <span style=color:#f92672>hooks</span>:
    - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>update-env-sample</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Auto update env.sample</span>
      <span style=color:#f92672>entry</span>: <span style=color:#ae81ff>python3 scripts/generate_env_file.py</span>
      <span style=color:#f92672>language</span>: <span style=color:#ae81ff>system</span>
      <span style=color:#f92672>always_run</span>: <span style=color:#66d9ef>true</span>
      <span style=color:#f92672>pass_filenames</span>: <span style=color:#66d9ef>false</span>
</code></pre></div><h2 id=enjoy>Enjoy!</h2>
</div>
<div class=post-footer>
</div>
</article>
</main>
</body>
</html>